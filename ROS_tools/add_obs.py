'''
# 彭，防止遗忘：本文件用于可视化障碍物，给定任意数量的训练日志的障碍物，都能在rviz中显示出来
'''

# from moveit_commander import PlanningSceneInterface
# import geometry_msgs.msg

# scene = PlanningSceneInterface()
# box_pose = geometry_msgs.msg.PoseStamped()
# box_pose.header.frame_id = "base_link"
# box_pose.pose.position.x = -0.8876
# box_pose.pose.position.y = -0.2288
# box_pose.pose.position.z = 0.1783

# box_pose2 = geometry_msgs.msg.PoseStamped()
# box_pose2.header.frame_id = "base_link"
# box_pose2.pose.position.x = -0.8320
# box_pose2.pose.position.y =  -0.8745 
# box_pose2.pose.position.z = 0.2948
# scene.add_box("obstacle", box_pose, size=(0.2668, 0.3179, 0.2755))
# scene.add_box("obstacle2", box_pose2, size=(0.2447, 0.2354, 0.3635))

import rospy
from moveit_commander import PlanningSceneInterface
from geometry_msgs.msg import PoseStamped

# 初始化 ROS 节点
rospy.init_node('add_obstacles')

# 创建 PlanningSceneInterface 实例
scene = PlanningSceneInterface()


# 这一组有突变
obstacless = [[[3.1415927410125732, 0.0, 0.0], [-0.3001998960971832, 0.2496613711118698, -1.1399258375167847], [0.25239354372024536, 0.3243868947029114, 0.49845024943351746]], [[3.1415927410125732, 0.0, 0.0], [-0.15981808304786682, 0.7705298662185669, -0.4696185886859894], [0.7509146928787231, 0.5654503703117371, 0.29663529992103577]], [[3.1415927410125732, 0.0, 0.0], [0.6546252965927124, 0.2753346562385559, -0.6980878114700317], [0.6307232975959778, 0.2760818898677826, 0.22221191227436066]], [[3.1415927410125732, 0.0, 0.0], [-0.008987454697489738, 1.3974570035934448, 0.12333492189645767], [0.3638761341571808, 0.3848072290420532, 0.4697958827018738]], [[3.1415927410125732, 0.0, 0.0], [0.7377092242240906, 0.21378076076507568, 1.358028769493103], [0.5820788145065308, 0.6447574496269226, 0.3050498366355896]], [[3.1415927410125732, 0.0, 0.0], [0.6861588954925537, -1.3283228874206543, -0.4855349063873291], [0.7788435220718384, 0.44535425305366516, 0.6208106279373169]], [[3.1415927410125732, 0.0, 0.0], [0.9557347893714905, -0.6145806908607483, -0.7984398007392883], [0.6159189343452454, 0.23982404172420502, 0.20122219622135162]], [[3.1415927410125732, 0.0, 0.0], [-0.23409384489059448, -0.942731499671936, -0.8676696419715881], [0.744828999042511, 0.47660067677497864, 0.6372495293617249]], [[3.1415927410125732, 0.0, 0.0], [0.09110566973686218, -1.013664960861206, 0.4974898397922516], [0.5247335433959961, 0.5676581859588623, 0.6377739906311035]], [[3.1415927410125732, 0.0, 0.0], [1.137189507484436, 0.238895446062088, -1.0614898204803467], [0.5297845602035522, 0.5193111896514893, 0.41881081461906433]]],

# 这一组还行
# obstacless =  [[[3.1415927410125732, 0.0, 0.0], [0.7328880429267883, 0.7601314187049866, -1.0946284532546997], [0.25045183300971985, 0.5203752517700195, 0.2988119423389435]], [[3.1415927410125732, 0.0, 0.0], [-0.6689720749855042, 0.5924124121665955, -1.077387809753418], [0.7484601140022278, 0.4238179922103882, 0.3632638156414032]], [[3.1415927410125732, 0.0, 0.0], [0.7651699185371399, 0.6423680782318115, 0.913861095905304], [0.4414251744747162, 0.5501530766487122, 0.7588955163955688]], [[3.1415927410125732, 0.0, 0.0], [1.193834900856018, 0.22693513333797455, -0.9598190188407898], [0.46816229820251465, 0.31606417894363403, 0.339617520570755]], [[3.1415927410125732, 0.0, 0.0], [-0.0336192287504673, -0.6991702318191528, -1.3757179975509644], [0.6971303224563599, 0.30608731508255005, 0.30621328949928284]], [[3.1415927410125732, 0.0, 0.0], [-1.1013522148132324, 1.060149908065796, 0.7605570554733276], [0.2464706003665924, 0.3463362157344818, 0.5877982974052429]], [[3.1415927410125732, 0.0, 0.0], [-0.21685771644115448, -0.18137569725513458, -1.1268216371536255], [0.6475210785865784, 0.22638501226902008, 0.28523147106170654]], [[3.1415927410125732, 0.0, 0.0], [-0.636130690574646, -0.4327715039253235, -0.5735959410667419], [0.7491073608398438, 0.3344211280345917, 0.634550929069519]], [[3.1415927410125732, 0.0, 0.0], [1.0986239910125732, -0.9496289491653442, 0.3325241208076477], [0.4793684184551239, 0.7462514042854309, 0.5325677990913391]], [[3.1415927410125732, 0.0, 0.0], [-1.2231801748275757, -1.082746148109436, 0.9924429655075073], [0.35071513056755066, 0.7695013880729675, 0.39244285225868225]]],
# 这一组有突变2
# obstacless =[[[3.1415927410125732, 0.0, 0.0], [-0.12646420300006866, -0.8977828621864319, -0.23604190349578857], [0.6563690304756165, 0.6630328297615051, 0.7212931513786316]], [[3.1415927410125732, 0.0, 0.0], [-0.37292805314064026, 0.44950351119041443, -0.9547333121299744], [0.7773998379707336, 0.6119318008422852, 0.6481354236602783]], [[3.1415927410125732, 0.0, 0.0], [1.013336420059204, 1.447129726409912, -1.2818570137023926], [0.6935144662857056, 0.22933602333068848, 0.39796334505081177]], [[3.1415927410125732, 0.0, 0.0], [1.1386772394180298, 0.09752818197011948, -1.2735434770584106], [0.34277018904685974, 0.7531726956367493, 0.2095056027173996]], [[3.1415927410125732, 0.0, 0.0], [0.9520014524459839, -1.0518280267715454, 0.3175297975540161], [0.4677101671695709, 0.31430986523628235, 0.6462929844856262]], [[3.1415927410125732, 0.0, 0.0], [-1.0675681829452515, 0.87876957654953, 0.7617374062538147], [0.25139278173446655, 0.7397252917289734, 0.5021206736564636]], [[3.1415927410125732, 0.0, 0.0], [0.24833953380584717, 0.8647994995117188, 1.188815712928772], [0.23665110766887665, 0.5751693248748779, 0.6887155771255493]], [[3.1415927410125732, 0.0, 0.0], [1.240419864654541, 0.965576171875, -0.40031740069389343], [0.4892338812351227, 0.346345990896225, 0.679756224155426]], [[3.1415927410125732, 0.0, 0.0], [0.9549311995506287, 1.185964584350586, 0.8459156155586243], [0.2020856738090515, 0.6131903529167175, 0.4284972548484802]], [[3.1415927410125732, 0.0, 0.0], [-1.1743075847625732, -0.05054055154323578, -0.6034201979637146], [0.627323567867279, 0.5874170660972595, 0.20843587815761566]]], 
# 9障碍物有突变
# obstacless = [[[3.1415927410125732, 0.0, 0.0], [-0.11604992300271988, 0.40276414155960083, -1.1618365049362183], [0.7588778138160706, 0.6880981922149658, 0.4793693423271179]], [[3.1415927410125732, 0.0, 0.0], [1.2076876163482666, 1.2286564111709595, -0.5356147289276123], [0.7495508790016174, 0.307062029838562, 0.6660254597663879]], [[3.1415927410125732, 0.0, 0.0], [1.0519838333129883, -1.2162097692489624, 1.3686443567276], [0.7005935907363892, 0.22947083413600922, 0.37908774614334106]], [[3.1415927410125732, 0.0, 0.0], [-1.0517712831497192, 1.2298834323883057, 0.8746547698974609], [0.24598976969718933, 0.4224545955657959, 0.6618316769599915]], [[3.1415927410125732, 0.0, 0.0], [-0.9275323748588562, -1.0891972780227661, 1.3493815660476685], [0.4420592188835144, 0.45991042256355286, 0.2643393874168396]], [[3.1415927410125732, 0.0, 0.0], [0.9721521139144897, 0.5880394577980042, 1.0844440460205078], [0.5999816060066223, 0.6673004031181335, 0.7406256794929504]], [[3.1415927410125732, 0.0, 0.0], [0.9361089468002319, -1.2011717557907104, 0.5127795338630676], [0.6933988928794861, 0.33711254596710205, 0.5581212043762207]], [[3.1415927410125732, 0.0, 0.0], [-0.19286319613456726, 0.6961896419525146, -0.3238396644592285], [0.35065793991088867, 0.6817321181297302, 0.2069159895181656]], [[3.1415927410125732, 0.0, 0.0], [0.7106762528419495, -0.4071350693702698, 0.09267234057188034], [0.25279438495635986, 0.21190790832042694, 0.5656856298446655]]], 
# 8障碍物
# obstacless = [[[3.1415927410125732, 0.0, 0.0], [1.3854401111602783, -0.3253290057182312, -0.09441597759723663], [0.36376023292541504, 0.5958212614059448, 0.7564249038696289]], [[3.1415927410125732, 0.0, 0.0], [-0.03702118992805481, -0.7214201092720032, 0.18059609830379486], [0.3159361481666565, 0.3064516484737396, 0.7782621383666992]], [[3.1415927410125732, 0.0, 0.0], [-1.1233763694763184, 0.5303118824958801, -0.43514150381088257], [0.520952582359314, 0.6577425599098206, 0.48963606357574463]], [[3.1415927410125732, 0.0, 0.0], [-1.1386650800704956, -1.2186367511749268, -0.9938057065010071], [0.7533596158027649, 0.6446821689605713, 0.6845909953117371]], [[3.1415927410125732, 0.0, 0.0], [1.338728666305542, 1.2529683113098145, 1.1383305788040161], [0.20647470653057098, 0.4555601477622986, 0.6604710221290588]], [[3.1415927410125732, 0.0, 0.0], [0.7949668169021606, -1.0688986778259277, 1.080295443534851], [0.3710775077342987, 0.4921638071537018, 0.6441622972488403]], [[3.1415927410125732, 0.0, 0.0], [1.3065661191940308, -0.9090927839279175, -0.4669586718082428], [0.23478415608406067, 0.246072918176651, 0.6634206175804138]], [[3.1415927410125732, 0.0, 0.0], [-0.34039878845214844, 0.9721944332122803, 0.8850528597831726], [0.6844925284385681, 0.24011299014091492, 0.6825109124183655]]], 
# 7障碍物
# obstacless = [[[3.1415927410125732, 0.0, 0.0], [1.0552526712417603, 0.7887239456176758, -1.0454323291778564], [0.5315624475479126, 0.45368680357933044, 0.6644070744514465]], [[3.1415927410125732, 0.0, 0.0], [-1.3549602031707764, -1.1823139190673828, 1.0468711853027344], [0.3623189628124237, 0.7319492101669312, 0.7466117143630981]], [[3.1415927410125732, 0.0, 0.0], [1.368981957435608, 0.6111705899238586, -0.4608938694000244], [0.2704356908798218, 0.4448060095310211, 0.4078228771686554]], [[3.1415927410125732, 0.0, 0.0], [0.3402654826641083, 0.9380355477333069, -0.99929279088974], [0.658653974533081, 0.3848869800567627, 0.4163905680179596]], [[3.1415927410125732, 0.0, 0.0], [0.8153900504112244, -0.8228325843811035, -0.8214943408966064], [0.43082714080810547, 0.2699509263038635, 0.5492228865623474]], [[3.1415927410125732, 0.0, 0.0], [-1.1619044542312622, 1.0493191480636597, 1.1291362047195435], [0.2146720141172409, 0.722629725933075, 0.7969039082527161]], [[3.1415927410125732, 0.0, 0.0], [-1.1226366758346558, 0.33092302083969116, -1.3391989469528198], [0.7416682839393616, 0.6088881492614746, 0.5005079507827759]]],
# 6障碍物
# obstacless = [[[3.1415927410125732, 0.0, 0.0], [0.16074737906455994, 0.09074276685714722, -0.48015356063842773], [0.2112630307674408, 0.47781455516815186, 0.3548428416252136]], [[3.1415927410125732, 0.0, 0.0], [1.0283057689666748, 0.43024855852127075, -1.0064504146575928], [0.23729194700717926, 0.6474955081939697, 0.7724938988685608]], [[3.1415927410125732, 0.0, 0.0], [0.5227358341217041, -0.8335442543029785, 0.1618545651435852], [0.778252124786377, 0.5489677786827087, 0.5164052248001099]], [[3.1415927410125732, 0.0, 0.0], [-1.2536520957946777, 0.7091066241264343, -0.25459015369415283], [0.35353928804397583, 0.6293507814407349, 0.3646218180656433]], [[3.1415927410125732, 0.0, 0.0], [0.8308221697807312, 0.9682847261428833, 1.085230827331543], [0.5174535512924194, 0.49668213725090027, 0.3109820783138275]], [[3.1415927410125732, 0.0, 0.0], [-1.2499206066131592, -0.656491756439209, -1.032282829284668], [0.20108796656131744, 0.476591020822525, 0.6762862205505371]]],
# 5障碍物
# obstacless = [[[3.1415927410125732, 0.0, 0.0], [1.0004684925079346, 1.2045400142669678, -0.8033917546272278], [0.48385298252105713, 0.6563935279846191, 0.5583727955818176]], [[3.1415927410125732, 0.0, 0.0], [-0.2318240851163864, 0.20309753715991974, -1.0367308855056763], [0.23301531374454498, 0.32555848360061646, 0.710948646068573]], [[3.1415927410125732, 0.0, 0.0], [0.9201340675354004, -0.19718587398529053, 0.6704165935516357], [0.39894723892211914, 0.685408353805542, 0.3284071981906891]], [[3.1415927410125732, 0.0, 0.0], [-1.1601569652557373, -1.3337422609329224, -1.2799937725067139], [0.5473489165306091, 0.48415106534957886, 0.5733287334442139]], [[3.1415927410125732, 0.0, 0.0], [0.37953975796699524, -0.5069499611854553, -0.4655047655105591], [0.5973881483078003, 0.5963045358657837, 0.5715620517730713]]], 

# 以下是有ik但是有碰撞的，看看筛选掉了啥东西？
# 3-4连杆碰撞
# obstacless = [[[3.1415927410125732, 0.0, 0.0], [0.33330923318862915, 0.2788502871990204, 0.3708420395851135], [0.6367433071136475, 0.6376211643218994, 0.4369947612285614]], [[3.1415927410125732, 0.0, 0.0], [-1.0728998184204102, -0.03235701844096184, 0.6024160385131836], [0.4639681577682495, 0.6985647082328796, 0.6884080767631531]], [[3.1415927410125732, 0.0, 0.0], [-1.0458391904830933, -0.5488413572311401, -0.6298430562019348], [0.4218761920928955, 0.34674355387687683, 0.5054842233657837]], [[3.1415927410125732, 0.0, 0.0], [-1.1301383972167969, -1.068522572517395, -0.675694465637207], [0.2538304626941681, 0.45997172594070435, 0.5237029194831848]], [[3.1415927410125732, 0.0, 0.0], [-0.2458503097295761, 1.120036005973816, 1.0240283012390137], [0.6212984323501587, 0.3042517900466919, 0.6721333861351013]], [[3.1415927410125732, 0.0, 0.0], [1.027034044265747, 1.2137045860290527, -0.6569483876228333], [0.5972997546195984, 0.44258058071136475, 0.6908262968063354]], [[3.1415927410125732, 0.0, 0.0], [-0.25324538350105286, -0.7468067407608032, 0.10739821195602417], [0.4096352458000183, 0.3104068636894226, 0.6116273403167725]], [[3.1415927410125732, 0.0, 0.0], [-0.7285926938056946, -0.7499856948852539, 1.0336817502975464], [0.5653887391090393, 0.6405757665634155, 0.6327025890350342]], [[3.1415927410125732, 0.0, 0.0], [1.0641018152236938, -1.0781240463256836, -1.393020749092102], [0.6098169684410095, 0.21596252918243408, 0.2847527861595154]]],
# 直接和基座碰撞
# obstacless = [[[3.1415927410125732, 0.0, 0.0], [-1.210151195526123, 0.2830479145050049, -0.2661157250404358], [0.5845319628715515, 0.605198860168457, 0.2979554831981659]], [[3.1415927410125732, 0.0, 0.0], [-1.1812517642974854, 0.762004554271698, 1.057930588722229], [0.6511999368667603, 0.22770053148269653, 0.4921693801879883]], [[3.1415927410125732, 0.0, 0.0], [0.10672662407159805, 0.2682932913303375, 0.05596768483519554], [0.6298882961273193, 0.5071202516555786, 0.2626095414161682]], [[3.1415927410125732, 0.0, 0.0], [-0.16872115433216095, 0.9868631958961487, -1.327384114265442], [0.5028940439224243, 0.5691179037094116, 0.5392733216285706]], [[3.1415927410125732, 0.0, 0.0], [0.11671505868434906, -0.7595331072807312, -0.527862012386322], [0.25273996591567993, 0.2044547200202942, 0.734244167804718]], [[3.1415927410125732, 0.0, 0.0], [0.9642661809921265, -1.3294284343719482, -0.13139617443084717], [0.6714779138565063, 0.35430601239204407, 0.5914295315742493]], [[3.1415927410125732, 0.0, 0.0], [-0.34136763215065, 1.0107088088989258, 1.0275170803070068], [0.6051626801490784, 0.41046369075775146, 0.6675160527229309]], [[3.1415927410125732, 0.0, 0.0], [0.9278382658958435, -0.3592747151851654, 1.3498533964157104], [0.6153237223625183, 0.4281858205795288, 0.2929791212081909]], [[3.1415927410125732, 0.0, 0.0], [1.2162673473358154, -1.290766716003418, -1.044377326965332], [0.21510730683803558, 0.3105595111846924, 0.434207946062088]]],
# 直接和基座碰撞2
# obstacless =[[[3.1415927410125732, 0.0, 0.0], [-0.47535690665245056, -1.0803669691085815, 0.3226989209651947], [0.5862997174263, 0.29442811012268066, 0.6262951493263245]], [[3.1415927410125732, 0.0, 0.0], [-0.32109418511390686, 0.8443923592567444, 0.8077352643013], [0.6426013112068176, 0.2839094400405884, 0.20379230380058289]], [[3.1415927410125732, 0.0, 0.0], [-1.1238887310028076, -1.3325228691101074, 0.5908764600753784], [0.5966829657554626, 0.3900502324104309, 0.789036750793457]], [[3.1415927410125732, 0.0, 0.0], [-0.15622614324092865, -0.10750247538089752, 0.15100301802158356], [0.54146808385849, 0.5089825391769409, 0.4450951814651489]], [[3.1415927410125732, 0.0, 0.0], [-0.4796963036060333, -0.15488174557685852, 1.193854570388794], [0.3917369544506073, 0.3925636112689972, 0.571195125579834]], [[3.1415927410125732, 0.0, 0.0], [0.27626833319664, 0.28017956018447876, -0.5834759473800659], [0.5539748072624207, 0.4757077991962433, 0.5180083513259888]], [[3.1415927410125732, 0.0, 0.0], [1.3358850479125977, -1.0424476861953735, 0.33875250816345215], [0.3855525553226471, 0.6424139142036438, 0.41425517201423645]], [[3.1415927410125732, 0.0, 0.0], [0.5963115096092224, -0.389225572347641, -0.918271005153656], [0.25103914737701416, 0.3272254168987274, 0.37268099188804626]], [[3.1415927410125732, 0.0, 0.0], [0.7971670031547546, 0.7939670085906982, -0.538588285446167], [0.2656448781490326, 0.6684890985488892, 0.723571240901947]]],
# obstacless =[[[3.1415927410125732, 0.0, 0.0], [-0.6895194053649902, 0.08981983363628387, -1.0260910987854004], [0.754693329334259, 0.6186264753341675, 0.471445769071579]], [[3.1415927410125732, 0.0, 0.0], [0.4950012266635895, 0.7039549350738525, 1.0960693359375], [0.7096875905990601, 0.7092372179031372, 0.6325363516807556]], [[3.1415927410125732, 0.0, 0.0], [0.39428409934043884, -1.1213645935058594, -0.4874236285686493], [0.5091575384140015, 0.6312038898468018, 0.5064256191253662]], [[3.1415927410125732, 0.0, 0.0], [-0.8625206351280212, 0.1219336986541748, 0.2778734266757965], [0.5038852691650391, 0.5832014679908752, 0.5804510116577148]], [[3.1415927410125732, 0.0, 0.0], [1.0941555500030518, 1.2901113033294678, 0.5600731372833252], [0.4062497019767761, 0.29214248061180115, 0.6981747150421143]], [[3.1415927410125732, 0.0, 0.0], [-1.2774790525436401, 1.3216173648834229, 0.6289516091346741], [0.24966706335544586, 0.4474419355392456, 0.4199705719947815]], [[3.1415927410125732, 0.0, 0.0], [0.6775473356246948, 1.10866379737854, -0.5227830410003662], [0.40777871012687683, 0.7850065231323242, 0.41681143641471863]], [[3.1415927410125732, 0.0, 0.0], [0.4655474126338959, -0.8478550910949707, 0.1994633823633194], [0.7382733225822449, 0.44974562525749207, 0.5133854746818542]], [[3.1415927410125732, 0.0, 0.0], [0.8641580939292908, -0.11256145685911179, 0.5842100381851196], [0.32383063435554504, 0.34653109312057495, 0.7620018124580383]]],



for obstacles in obstacless:
# 遍历障碍物，提取位置和尺寸并添加到场景中
    for i, obstacle in enumerate(obstacles):
        _, position, size = obstacle  # 忽略 [r, p, y]
        print('position', position)
        x, y, z = position
        l, w, h = size

        # 创建障碍物的位姿
        box_pose = PoseStamped()
        box_pose.header.frame_id = "base_link"
        box_pose.pose.position.x = -x
        box_pose.pose.position.y = -y
        box_pose.pose.position.z = z

        # 添加到场景
        obstacle_name = f"obstacle_{i+1}"
        scene.add_box(obstacle_name, box_pose, size=(l, w, h))
        rospy.sleep(0.5)  # 确保障碍物被成功添加

print("All obstacles have been added to the planning scene.")
